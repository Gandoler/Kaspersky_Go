# Для лучше репрезентативности, перейдите пожалуйста в мой [gitHub](https://github.com/Gandoler/Kaspersky_Go) репозиторий
# Kaspersky Go Test Assignments (TASK_1, TASK_2, TASK_3)


Этот репозиторий содержит три независимых тестовых задания на Go. Для каждого задания приведены описание, требования, инструкция по запуску и тестированию.

### Структура репозитория
```
./
  TASK_1/   # Очередь задач + HTTP API + worker pool + ретраи/бэкофф
  TASK_2/   # Базовый WorkerPool + тесты
  TASK_3/   # Интерфейс Pool с очередью, ограничениями и хуком
```



---

## TASK_1 — Внутренняя очередь и обработка заданий

Реализована внутренняя буферизированная очередь и пул воркеров с ретраями и экспоненциальным бэкоффом (с джиттером), а также HTTP API.

Основные требования (реализовано):
- Прием заданий через `POST /enqueue` c телом:
  ```json
  {"id":"<string>","payload":"<string>","max_retries":<int>}
  ```
- Задания попадают в буферизированную очередь (размер из конфигурации).
- Обработка задания пулом воркеров (`WORKERS` из env). Время «работы» симулируется 100–500 мс.
- Примерно 20% задач «падают» (симуляция ошибок) — включены повторы до `max_retries` с экспоненциальным бэкоффом и джиттером.
- Хранение и обновление состояния задач: `queued | running | done | failed`.
- Healthcheck `GET /healthz` → `200 OK`.
- Корректное завершение по `SIGINT/SIGTERM`: прекращаем прием новых задач, дожидаемся завершения текущих.
- Без сторонних библиотек.
- Конфигурация через переменные окружения:
  - `WORKERS` (по умолчанию 4)
  - `QUEUE_SIZE` (по умолчанию 64)

### Запуск
```bash
cd TASK_1
set WORKERS=4        # Windows PowerShell: $env:WORKERS=4
set QUEUE_SIZE=64    # Windows PowerShell: $env:QUEUE_SIZE=64
go build -o app.exe .
./app.exe
```

По умолчанию HTTP-сервер стартует на `:8080` (см. `TASK_1/main.go`).

### HTTP API
- `POST /enqueue`
  - Тело:
    ```json
    {"id":"job-1","payload":"any","max_retries":3}
    ```
  - Пример запроса:
    ```bash
    curl -X POST http://localhost:8080/enqueue \
      -H "Content-Type: application/json" \
      -d '{"id":"job-1","payload":"hello","max_retries":3}'
    ```

- `GET /healthz`
  - Пример:
    ```bash
    curl http://localhost:8080/healthz
    ```


### Тесты
```bash
cd TASK_1/TESTS
go test ./...
```
Основные тесты: адаптеры очереди и хранилища состояния, обработчик HTTP, ретрай-процессор, worker pool.

---

## TASK_2 — WorkerPool с методами Submit/SubmitWait/Stop/StopWait

Задание команды разработки решений для управления корпоративной защитой: реализовать `WorkerPool` и покрыть тестами.

В этом репозитории:
- Интерфейсы и реализация находятся в `TASK_2/WorkerPool/`.
- Тесты — в `TASK_2/tests/`.

Ожидаемые методы:
- `Submit(task func())` — добавить таску в пул (не ждать завершения).
- `SubmitWait(task func())` — добавить таску и дождаться её выполнения.
- `Stop()` — остановить пул, дождаться выполнения только тех задач, которые уже выполняются.
- `StopWait()` — остановить пул и дождаться выполнения всех задач, включая те, что в очереди.

### Запуск тестов
```bash
cd TASK_2
go test ./...
```

---

## TASK_3 — Интерфейс Pool c очередью, ограничениями и хуком

Задание команды разработки песочниц: реализовать интерфейс, позволяющий выполнять задачи параллельно.

Требуемый интерфейс:
```go
type Pool interface {
    // Submit — добавить задачу в пул. Если нет свободных воркеров, задача уходит в очередь.
    Submit(task func()) error

    // Stop — остановить пул и дождаться выполнения всех задач, уже находящихся в очереди.
    Stop() error
}
```

Дополнительно реализовано:
- Ограничение размера очереди. Если очередь переполнена — `Submit` возвращает ошибку.
- Хук, вызываемый после выполнения каждой задачи (при необходимости подключается на уровне реализации).

### Запуск тестов
```bash
cd TASK_3
go test ./...
```
