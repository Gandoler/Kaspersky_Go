# –î–ª—è –ª—É—á—à–µ —Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤ –º–æ–π [gitHub](https://github.com/Gandoler/Kaspersky_Go) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

# TASK 2 –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ WorkerPool

## –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–æ—Å—Ç–æ–π –ø—É–ª –≤–æ—Ä–∫–µ—Ä–æ–≤ (worker pool) –Ω–∞ Go. –ü—É–ª –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–¥–∞—á–∏ (`func()`), –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∏—Ö –≤ `N` –≤–æ—Ä–∫–µ—Ä–∞—Ö –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 4 –º–µ—Ç–æ–¥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

* `NewWorkerPool(numberOfWorkers int) *WorkerPool` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø—É–ª —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ—Ä–∫–µ—Ä–æ–≤ (–µ—Å–ª–∏ `numberOfWorkers < 1` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nil`).
* `Submit(task func())` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç: –µ—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–æ–ª–Ω–∞ ‚Äî –∑–∞–¥–∞—á–∞ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è).
* `SubmitWait(task func())` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –∏ –∂–¥–∞—Ç—å –µ—ë –æ–∫–æ–Ω—á–∞–Ω–∏—è (–ª–æ–∫–∞–ª—å–Ω–æ ‚Äî –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–∑—ã–≤–∞—é—â–∏–π –≥–æ—Ä—É—Ç–∏–Ω—É –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏).
* `Stop()` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É–ª (–≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ—á–µ—Ä–µ–¥—å –∏ –æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤).
* `StopWait()` ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—É–ª –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á (–≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ `Stop()` + –æ–∂–∏–¥–∞–Ω–∏–µ `wgTasks`).


## –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∫–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

* `queue chan func()` ‚Äî –±—É—Ñ–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞–Ω–∞–ª –∑–∞–¥–∞—á (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –µ–º–∫–æ—Å—Ç—å 64).
* `wgWorkers sync.WaitGroup` ‚Äî –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–≥–æ—Ä—É—Ç–∏–Ω).
* `wgTasks sync.WaitGroup` ‚Äî —Å—á–∏—Ç–∞–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `SubmitWait` –∏ `StopWait`.
* `stateMu sync.Mutex` –∏ –±—É–ª–µ–≤–æ `stopped` ‚Äî –∑–∞—â–∏—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ—Å–ª–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.
* `stopOnce sync.Once` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ª–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –µ–¥–∏–Ω–æ–∂–¥—ã.


# –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è WorkerPool

–ù–∏–∂–µ ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –∏ –ø–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ `README.md` –∏–ª–∏ `TASK_2.md` (–±–µ–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–æ–¥–∞). –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ —É–∫–∞–∑–∞–Ω–∞ —Ü–µ–ª—å, –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —á—Ç–æ –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏.

## –û–±—â–µ–µ

–¢–µ—Å—Ç—ã —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—É–ªa –≤–æ—Ä–∫–µ—Ä–æ–≤:

* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—É–ª–∞,
* –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á (–≤–∫–ª—é—á–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏),
* –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ `nil`-—Ç–∞—Å–∫–∞—Ö,
* —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ—á–µ—Ä–µ–¥–∏,
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã `SubmitWait`,
* —Å–µ–º–∞–Ω—Ç–∏–∫–∞ –º–µ—Ç–æ–¥–æ–≤ `Stop` –∏ `StopWait`,
* –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

–í —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏ (`atomic`) –∏ `sync.WaitGroup` –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω—è –∑–∞–¥–∞—á. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ —ë–º–∫–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ—á–µ—Ä–µ–¥–∏ (–≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî 64), –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∏–º–µ–Ω–Ω–æ —Ç—É —Å–µ–º–∞–Ω—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–¥–∞–Ω–∞ —Ç–µ–∫—É—â–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏.


–û–∫–µ–π üëç –î–∞–≤–∞–π —è —É–∂–º—É —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤ –¥–æ –∫—Ä–∞—Ç–∫–æ–≥–æ –∫–æ–Ω—Å–ø–µ–∫—Ç–∞ (—Ü–µ–ª—å + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É).

---

## –°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤

* **TestNewWorkerPool_InvalidWorkers** ‚Äî `NewWorkerPool(0)` ‚Üí `nil`.
* **TestSubmit_ExecutesAllTasks** ‚Äî –≤—Å–µ `Submit`-—Ç–∞—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ `StopWait()`.
* **TestSubmit_NilTaskIgnored** ‚Äî `Submit(nil)`/`SubmitWait(nil)` –Ω–µ –ø–∞–¥–∞—é—Ç.
* **TestSubmitWait_BlocksUntilTaskDone** ‚Äî `SubmitWait` –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.
* **TestQueueCapacity_DropsWhenFull** ‚Äî –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ >64 –∑–∞–¥–∞—á –ª–∏—à–Ω–∏–µ –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.
* **TestStop_PreventsNewSubmissions** ‚Äî –ø–æ—Å–ª–µ `Stop()` –Ω–æ–≤—ã–µ —Ç–∞—Å–∫–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è.
* **TestStopWait_WaitsForAllQueuedTasks** ‚Äî `StopWait()` –∂–¥—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á.
* **TestStop_Idempotent** ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ `Stop()` –±–µ–∑–æ–ø–∞—Å–Ω—ã.
* **TestConcurrent_SubmitAndSubmitWait** ‚Äî –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ `Submit`/`SubmitWait` –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –±–µ–∑ –≥–æ–Ω–æ–∫.
