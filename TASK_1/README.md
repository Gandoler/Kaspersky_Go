## Kaspersky Container Security — Очередь фоновой обработки задач

Внутренний сервис для приёма задач через HTTP и их фоновой обработки пулом воркеров с повторными попытками и экспоненциальным бэкоффом.

### Архитектура (слои)

- `APILevel/HTTPServer`: HTTP-сервер и хендлеры (`/healthz`, `/enqueue`).
- `APILevel/Adapters`: внутренняя реализация адаптеров — буферизированная очередь и хранилище состояний в памяти.
- `ServiceLevel/UseCases/WokerPool`: пул воркеров, забирающий задания из очереди, обновляющий статусы и вызывающий процессор.
- `ServiceLevel/UseCases/Processors`: процессор задач с имитацией работы, отказов, бэкоффа и ретраев.
- `APILevel/Builder`: сборка `App` из компонентов и управление запуском/остановкой (graceful shutdown).
- `ModeLevel/Structures`: типы и состояния задач.

### Запуск

Переменные окружения:
- `WORKERS` — количество воркеров; по заданию значение по умолчанию 4
- `QUEUE_SIZE` — размер буфера очереди; по заданию значение по умолчанию 64

Пример запуска (PowerShell/Unix shell):
```bash
export WORKERS=4
export QUEUE_SIZE=64
go run ./...
```

Примечание: в текущей версии `main.go` требует, чтобы обе переменные были заданы, иначе программа завершится ошибкой конвертации. Это отмечено в чек-листе соответствия как пункт для доработки (см. ниже).

### HTTP API

- `GET /healthz`
  - Ответ: `200 OK`, тело — `OK`

- `POST /enqueue`
  - Тело JSON:
    ```json
    {"id":"<string>","payload":"<string>","max_retries":<int>}
    ```
  - Поведение: задача кладётся в буферизированную очередь, в `state` устанавливается статус `queued`
  - Ответ: `202 Accepted`, тело: `{"status":"queued"}`

### Состояния задач

Определены в `ModeLevel/Structures/Structs.go`:
- `queued`, `running`, `done`, `failed`

### Обработка задач

- Пул воркеров (`WokerPool`): число воркеров настраивается через `WORKERS`.
- Процессор (`RetryProcessor`):
  - имитирует выполнение 100–150 мс в текущей реализации
  - 20% вероятности «падения»
  - экспоненциальный бэкофф c джиттером между ретраями
  - до `max_retries` повторов

### Завершение (graceful shutdown)

`App.Start` перехватывает `SIGINT/SIGTERM`, останавливает HTTP-сервер через `Shutdown(ctx)` и закрывает очередь; воркеры завершаются после обработки текущей задачи (или выхода из канала после `Close()`).

### Тесты

См. `TESTS/README.md`.

Запуск:
```bash
go test ./...
```

---

## пытался использовать чистую архитектуру и паттерн строитель
